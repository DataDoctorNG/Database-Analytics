/* Create Tables */
CREATE TABLE CUSTOMERS (	
CUSTOMER_ID NUMBER(*,0) NOT NULL, 
EMAIL_ADDRESS VARCHAR2(255 CHAR) NOT NULL, 
FULL_NAME VARCHAR2(255 CHAR) NOT NULL);

CREATE TABLE ORDERS (	
ORDER_ID NUMBER(*,0) NOT NULL, 
ORDER_DATETIME TIMESTAMP NOT NULL, 
CUSTOMER_ID NUMBER(*,0) NOT NULL,
ORDER_STATUS VARCHAR2(10 CHAR) DEFAULT ('PROCESSING') NOT NULL, 
STORE_ID NUMBER(*,0) NOT NULL
);

CREATE TABLE ORDER_ITEMS (	
ORDER_ID NUMBER(*,0) NOT NULL, 
LINE_ITEM_ID NUMBER(*,0) NOT NULL, 
PRODUCT_ID NUMBER(*,0) NOT NULL,
UNIT_PRICE NUMBER(10,2) NOT NULL, 
QUANTITY NUMBER(*,0) DEFAULT 1 NOT NULL, 
LINE_ID NUMBER NOT NULL
);

CREATE TABLE PRODUCTS (	
PRODUCT_ID NUMBER(*,0) NOT NULL, 
PRODUCT_NAME VARCHAR2(250 CHAR) NOT NULL, 
UNIT_PRICE NUMBER(10,2) CHECK (UNIT_PRICE BETWEEN .01 AND 10000),
PRODUCT_DETAILS BLOB NULL, 
PRODUCT_IMAGE BLOB NULL, 
IMAGE_MIME_TYPE VARCHAR(512 CHAR),
IMAGE_FILENAME VARCHAR(512 CHAR),
IMAGE_CHARSET VARCHAR(512 CHAR),
IMAGE_LAST_UPDATED DATE
);

CREATE TABLE SHIPMENTS (	
LINE_ID NUMBER NOT NULL, 
SUPPLIER_ID NUMBER(38) NOT NULL, 
QUANTITY_SHIPPED NUMBER(38,4) NOT NULL,
SHIPPER VARCHAR2(127 BYTE),
TRACKING_NUM VARCHAR2(127 BYTE),
SHIPDATE DATE
);

CREATE TABLE SUPPLIERS (	
SUPPLIER_ID NUMBER(38) NOT NULL, 
SUPPLIER_NAME VARCHAR2(255 BYTE) NOT NULL, 
MAIN_CONTACT VARCHAR2(255 BYTE),
MAIN_PHONE VARCHAR2(50 BYTE),
MAIN_EMAIL VARCHAR2(255 BYTE)
);

CREATE TABLE SUPPLIER_MANU (	
SUPPLIER_MANU_ID NUMBER(38) NOT NULL, 
IS_ISO9000CERT CHAR(1 BYTE) DEFAULT 'N' NOT NULL, 
IS_SME_LEAN_CERT CHAR(1 BYTE) NOT NULL
);

CREATE TABLE SUPPLIER_WS (	
SUPPLIER_WS_ID NUMBER(38) NOT NULL, 
WHOLESALE_LICENSE VARCHAR2(20 BYTE), 
EIN VARCHAR2(20 BYTE)
);

/* Add Constraints */
/* Primary keys */

ALTER TABLE CUSTOMERS ADD CONSTRAINT CUSTOMERS_PK PRIMARY KEY (CUSTOMER_ID);

ALTER TABLE ORDERS ADD CONSTRAINT ORDERS_PK PRIMARY KEY (ORDER_ID);

ALTER TABLE ORDER_ITEMS ADD CONSTRAINT ORDER_ITEMS_PK PRIMARY KEY (LINE_ID);

ALTER TABLE PRODUCTS ADD CONSTRAINT PRODUCTS_PK PRIMARY KEY (PRODUCT_ID);

ALTER TABLE SHIPMENTS ADD CONSTRAINT SHIPMENTS_PK PRIMARY KEY (LINE_ID, SUPPLIER_ID);

ALTER TABLE SUPPLIERS ADD CONSTRAINT SUPPLIERS_PK PRIMARY KEY (SUPPLIER_ID);

ALTER TABLE SUPPLIER_MANU ADD CONSTRAINT SUPPLIER_MANU_PK PRIMARY KEY (SUPPLIER_MANU_ID);

ALTER TABLE SUPPLIER_WS ADD CONSTRAINT SUPPLIER_WS_PK PRIMARY KEY (SUPPLIER_WS_ID);

/* Unique values */

ALTER TABLE CUSTOMERS ADD CONSTRAINT CUSTOMERS_EMAIL_U UNIQUE (EMAIL_ADDRESS);

ALTER TABLE ORDER_ITEMS ADD CONSTRAINT ORDER_ITEMS_UK1 UNIQUE (ORDER_ID, LINE_ITEM_ID);

ALTER TABLE ORDER_ITEMS ADD CONSTRAINT ORDER_ITEMS_PRODUCT_U UNIQUE (PRODUCT_ID, ORDER_ID);

ALTER TABLE SUPPLIERS ADD CONSTRAINT SUPPLIERS_UK1 UNIQUE (SUPPLIER_NAME);

/* Foreign Keys */

ALTER TABLE ORDERS ADD CONSTRAINT ORDERS_CUSTOMER_ID_FK FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMERS(CUSTOMER_ID);

ALTER TABLE ORDER_ITEMS ADD CONSTRAINT ORDER_ITEMS_ORDER_ID_FK FOREIGN KEY (ORDER_ID) REFERENCES ORDERS(ORDER_ID);

ALTER TABLE ORDER_ITEMS ADD CONSTRAINT ORDER_ITEMS_PRODUCT_ID_FK FOREIGN KEY (PRODUCT_ID) REFERENCES PRODUCTS(PRODUCT_ID);

ALTER TABLE SHIPMENTS ADD CONSTRAINT SHIPMENTS_FK1 FOREIGN KEY (SUPPLIER_ID) REFERENCES SUPPLIERS(SUPPLIER_ID);

ALTER TABLE SHIPMENTS ADD CONSTRAINT SHIPMENTS_FK2 FOREIGN KEY (LINE_ID) REFERENCES ORDER_ITEMS(LINE_ID);

ALTER TABLE SUPPLIER_MANU ADD CONSTRAINT SUPPLIER_MANU_FK1 FOREIGN KEY (SUPPLIER_MANU_ID) REFERENCES SUPPLIERS(SUPPLIER_ID);

ALTER TABLE SUPPLIER_WS ADD CONSTRAINT SUPPLIER_WS_FK1 FOREIGN KEY (SUPPLIER_WS_ID) REFERENCES SUPPLIERS(SUPPLIER_ID);

/* Check Constraints */

ALTER TABLE CUSTOMERS ADD CONSTRAINT Email_Check CHECK(EMAIL_ADDRESS LIKE '%_@_%');  

ALTER TABLE CUSTOMERS ADD CONSTRAINT Name_Check CHECK(LENGTH(FULL_NAME)>=2);

ALTER TABLE SUPPLIER_MANU ADD CONSTRAINT IS_IS090000CERT_Check CHECK((IS_ISO9000CERT='N') OR (IS_ISO9000CERT='Y'));
